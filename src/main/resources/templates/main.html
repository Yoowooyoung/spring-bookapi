<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }
        .section { margin-bottom: 25px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .section-title { font-weight: bold; margin-bottom: 10px; color: #555; display: block; }
        .form-group { display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; min-width: 150px; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .btn-blue { background-color: #007bff; color: white; }
        .btn-green { background-color: #28a745; color: white; }
        .btn-yellow { background-color: #ffc107; color: black; }
        .btn-red { background-color: #dc3545; color: white; }
        .btn-gray { background-color: #6c757d; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background-color: #f8f9fa; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“š ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

    <div class="section">
        <span class="section-title">ğŸ” ë„ì„œ ì¡°íšŒ</span>
        <div class="form-group">
            <input type="number" id="searchId" placeholder="ì¡°íšŒí•  ë„ì„œ ID ì…ë ¥">
            <button class="btn-blue" onclick="fetchOneBook()">IDë¡œ ì¡°íšŒ</button>
            <button class="btn-gray" onclick="fetchAllBooks()">ì „ì²´ ëª©ë¡ ë³´ê¸°</button>
        </div>
    </div>

    <div class="section">
        <span class="section-title">ğŸ“ ë„ì„œ ë“±ë¡ ë° ìˆ˜ì •</span>
        <div class="form-group">
            <input type="hidden" id="bookId">
            <input type="text" id="bookTitle" placeholder="ë„ì„œ ì œëª©">
            <input type="text" id="bookAuthor" placeholder="ì €ì">
            <input type="text" id="bookIsbn" placeholder="ISBN">
            <input type="date" id="bookPublishedDate"> </div>
        <div style="text-align: right;">
            <button id="submitBtn" class="btn-green" onclick="handleSave()">ë“±ë¡</button>
            <button id="cancelBtn" class="btn-gray" style="display:none;" onclick="resetForm()">ì·¨ì†Œ</button>
        </div>
    </div>

    <table>
        <thead>
        <tr>
            <th>ID</th>
            <th>ì œëª©</th>
            <th>ì €ì</th>
            <th>ISBN</th>
            <th>ì¶œíŒì¼</th>
            <th>ê´€ë¦¬</th>
        </tr>
        </thead>
        <tbody id="bookTableBody">
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', fetchAllBooks);

    // [ì „ì²´ ì¡°íšŒ]
    function fetchAllBooks() {
        fetch('/api/books')
            .then(res => res.json())
            .then(data => renderTable(data))
            .catch(err => console.error('ì¡°íšŒ ì—ëŸ¬:', err));
    }

    // [ë‹¨ê±´ ì¡°íšŒ]
    function fetchOneBook() {
        const id = document.getElementById('searchId').value;
        if(!id) { alert('IDë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }

        fetch(`/api/books/${id}`)
            .then(res => {
                if(!res.ok) throw new Error('ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return res.json();
            })
            .then(book => renderTable([book]))
            .catch(err => {
                alert(err.message);
                renderTable([]);
            });
    }

    // [í…Œì´ë¸” ì¶œë ¥]
    function renderTable(books) {
        const tbody = document.getElementById('bookTableBody');
        tbody.innerHTML = '';

        if (!books || books.length === 0 || !books[0]) {
            tbody.innerHTML = '<tr><td colspan="6">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }

        books.forEach(book => {
            tbody.innerHTML += `
                <tr>
                    <td>${book.id}</td>
                    <td>${book.title}</td>
                    <td>${book.author}</td>
                    <td>${book.isbn}</td>
                    <td>${book.publishedDate || '-'}</td>
                    <td>
                        <button class="btn-yellow" onclick="setEditMode(${book.id}, '${book.title}', '${book.author}', '${book.isbn}', '${book.publishedDate}')">ìˆ˜ì •</button>
                        <button class="btn-red" onclick="deleteBook(${book.id})">ì‚­ì œ</button>
                    </td>
                </tr>`;
        });
    }

    // [ë“±ë¡ ë° ìˆ˜ì • ì‹¤í–‰]
    function handleSave() {
        const id = document.getElementById('bookId').value;
        const title = document.getElementById('bookTitle').value;
        const author = document.getElementById('bookAuthor').value;
        const isbn = document.getElementById('bookIsbn').value;
        const publishedDate = document.getElementById('bookPublishedDate').value;

        if(!title || !author || !isbn || !publishedDate) {
            alert('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        // ìˆ˜ì •(PUT)ì€ /api/books/{id}, ë“±ë¡(POST)ì€ /api/books ë¼ê³  ê°€ì •
        const url = id ? `/api/books/${id}` : '/api/books';
        const method = id ? 'PUT' : 'POST';
        const bodyData = { title, author, isbn, publishedDate };

        fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bodyData)
        })
            .then(res => {
                if(!res.ok) throw new Error('ì €ì¥ ì‹¤íŒ¨');
                alert(id ? 'ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                resetForm();
                fetchAllBooks();
            })
            .catch(err => alert(err.message));
    }

    // [ì‚­ì œ]
    function deleteBook(id) {
        if(!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) return;
        fetch(`/api/books/${id}`, { method: 'DELETE' })
            .then(() => fetchAllBooks())
            .catch(err => alert('ì‚­ì œ ì‹¤íŒ¨'));
    }

    // [ìˆ˜ì • ëª¨ë“œë¡œ ì „í™˜]
    function setEditMode(id, title, author, isbn, date) {
        document.getElementById('bookId').value = id;
        document.getElementById('bookTitle').value = title;
        document.getElementById('bookAuthor').value = author;
        document.getElementById('bookIsbn').value = isbn;
        document.getElementById('bookPublishedDate').value = date;

        document.getElementById('submitBtn').innerText = 'ìˆ˜ì • ì™„ë£Œ';
        document.getElementById('submitBtn').className = 'btn-yellow';
        document.getElementById('cancelBtn').style.display = 'inline-block';
    }

    // [í¼ ì´ˆê¸°í™”]
    function resetForm() {
        document.getElementById('bookId').value = '';
        document.getElementById('bookTitle').value = '';
        document.getElementById('bookAuthor').value = '';
        document.getElementById('bookIsbn').value = '';
        document.getElementById('bookPublishedDate').value = '';

        document.getElementById('submitBtn').innerText = 'ë“±ë¡';
        document.getElementById('submitBtn').className = 'btn-green';
        document.getElementById('cancelBtn').style.display = 'none';
    }
</script>
</body>
</html>