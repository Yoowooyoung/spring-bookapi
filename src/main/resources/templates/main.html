<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #333; }

        .section { margin-bottom: 25px; padding: 15px; border: 1px solid #eee; border-radius: 8px; }
        .section-title { font-weight: bold; margin-bottom: 10px; color: #555; display: block; }

        .form-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; }
        button { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; }

        .btn-blue { background-color: #007bff; color: white; }
        .btn-green { background-color: #28a745; color: white; }
        .btn-yellow { background-color: #ffc107; color: black; }
        .btn-red { background-color: #dc3545; color: white; }
        .btn-gray { background-color: #6c757d; color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background-color: #f8f9fa; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“š ë„ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>

    <div class="section">
        <span class="section-title">ğŸ” ë„ì„œ ì¡°íšŒ</span>
        <div class="form-group">
            <input type="number" id="searchId" placeholder="ì¡°íšŒí•  ë„ì„œ ID ì…ë ¥">
            <button class="btn-blue" onclick="fetchOneBook()">IDë¡œ ì¡°íšŒ</button>
            <button class="btn-gray" onclick="fetchAllBooks()">ì „ì²´ ëª©ë¡ ë³´ê¸°</button>
        </div>
    </div>

    <div class="section">
        <span class="section-title">ğŸ“ ë„ì„œ ë“±ë¡ ë° ìˆ˜ì •</span>
        <div class="form-group">
            <input type="hidden" id="bookId">
            <input type="text" id="bookTitle" placeholder="ë„ì„œ ì œëª© ì…ë ¥">
            <button id="submitBtn" class="btn-green" onclick="handleSave()">ë“±ë¡</button>
            <button id="cancelBtn" class="btn-gray" style="display:none;" onclick="resetForm()">ì·¨ì†Œ</button>
        </div>
    </div>

    <table>
        <thead>
        <tr>
            <th style="width: 15%;">ID</th>
            <th style="width: 55%;">ë„ì„œ ì œëª©</th>
            <th style="width: 30%;">ê´€ë¦¬</th>
        </tr>
        </thead>
        <tbody id="bookTableBody">
        </tbody>
    </table>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì „ì²´ ëª©ë¡ ì¡°íšŒ
    document.addEventListener('DOMContentLoaded', fetchAllBooks);

    // [ì „ì²´ ì¡°íšŒ]
    function fetchAllBooks() {
        fetch('/api/books')
            .then(res => res.json())
            .then(data => renderTable(data))
            .catch(err => console.error('ì¡°íšŒ ì—ëŸ¬:', err));
    }

    // [IDë¡œ ë‹¨ê±´ ì¡°íšŒ]
    function fetchOneBook() {
        const id = document.getElementById('searchId').value;
        if(!id) { alert('IDë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }

        // API ê²½ë¡œê°€ /api/books/{id} ë¼ê³  ê°€ì •
        fetch(`/api/books/${id}`)
            .then(res => {
                if(!res.ok) throw new Error('ë„ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return res.json();
            })
            .then(book => renderTable([book])) // í•œ ê¶Œë§Œ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¡œ ì „ë‹¬
            .catch(err => {
                alert(err.message);
                renderTable([]);
            });
    }

    // [í…Œì´ë¸” ë Œë”ë§ í•¨ìˆ˜]
    function renderTable(books) {
        const tbody = document.getElementById('bookTableBody');
        tbody.innerHTML = '';

        if (books.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }

        books.forEach(book => {
            tbody.innerHTML += `
                <tr>
                    <td>${book.id}</td>
                    <td>${book.title}</td>
                    <td>
                        <button class="btn-yellow" onclick="setEditMode(${book.id}, '${book.title}')">ìˆ˜ì •</button>
                        <button class="btn-red" onclick="deleteBook(${book.id})">ì‚­ì œ</button>
                    </td>
                </tr>`;
        });
    }

    // [ì €ì¥/ìˆ˜ì • ë¡œì§]
    function handleSave() {
        const id = document.getElementById('bookId').value;
        const title = document.getElementById('bookTitle').value;
        if(!title) return;

        const method = id ? 'PUT' : 'POST';
        const bodyData = id ? { id, title } : { title };

        fetch('/api/books', {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(bodyData)
        }).then(() => {
            resetForm();
            fetchAllBooks();
        });
    }

    // [ì‚­ì œ ë¡œì§]
    function deleteBook(id) {
        if(!confirm('ì‚­ì œí• ê¹Œìš”?')) return;
        fetch(`/api/books/${id}`, { method: 'DELETE' })
            .then(() => fetchAllBooks());
    }

    // ìˆ˜ì • ëª¨ë“œ ì „í™˜
    function setEditMode(id, title) {
        document.getElementById('bookId').value = id;
        document.getElementById('bookTitle').value = title;
        document.getElementById('submitBtn').innerText = 'ìˆ˜ì • ì™„ë£Œ';
        document.getElementById('cancelBtn').style.display = 'inline-block';
    }

    function resetForm() {
        document.getElementById('bookId').value = '';
        document.getElementById('bookTitle').value = '';
        document.getElementById('submitBtn').innerText = 'ë“±ë¡';
        document.getElementById('cancelBtn').style.display = 'none';
    }
</script>
</body>
</html>